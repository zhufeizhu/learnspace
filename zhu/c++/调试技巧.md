## è°ƒè¯•æŠ€å·§

### coredump
å‡ºç°coredumpä¹‹å ç³»ç»Ÿä¼šå°†å‡ºé”™æ—¶çš„ç³»ç»Ÿä¸Šä¸‹æ–‡ä¿å­˜åœ¨coreæ–‡ä»¶å½“ä¸­ æ­¤æ—¶å¯ä»¥é€šè¿‡è·å–coreæ–‡ä»¶æ¥ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•åˆ¤æ–­ä»£ç å‡ºé”™çš„åœ°æ–¹ ä½†æ˜¯æœ‰çš„æ—¶å€™coreæ–‡ä»¶å‡ºä¸æ¥ å’‹åŠå‘¢ï¼Ÿ
1. coreæ–‡ä»¶çš„äº§ç”Ÿæ˜¯æœ‰é…ç½®çš„ å¯ä»¥ä½¿ç”¨ulimit -aæ¥æŸ¥çœ‹ å¦‚ä¸‹
```shell
    -t: cpu time (seconds)              unlimited
    -f: file size (blocks)              unlimited
    -d: data seg size (kbytes)          unlimited
    -s: stack size (kbytes)             8192
    -c: core file size (blocks)         unlimited
    -m: resident set size (kbytes)      unlimited
    -u: processes                       643027
    -n: file descriptors                1048576
    -l: locked-in-memory size (kbytes)  20585816
    -v: address space (kbytes)          unlimited
    -x: file locks                      unlimited
    -i: pending signals                 643027
    -q: bytes in POSIX msg queues       819200
    -e: max nice                        0
    -r: max rt priority                 0
    -N 15:                              unlimited
```
é‡ç‚¹å…³æ³¨ä¸‹core file sizeè¿™ä¸ªé€‰é¡¹  è¿™ä¸ªé€‰é¡¹è®¾ç½®äº†å¯ä»¥ç”Ÿæˆçš„coreæ–‡ä»¶çš„æœ€å¤§å¤§å° ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªé»˜è®¤å€¼æ˜¯0 ä½¿ç”¨`ulimit -c unlimited`å‘½ä»¤æ¥å°†å…¶è®¾ç½®ä¸º**unlimited**

2. ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¹‹å ä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„å½“å‰è·¯å¾„ä¸‹æ¥æ‰¾åˆ°å¯¹åº”çš„coreæ–‡ä»¶ ä½†æ˜¯å¦‚æœæ‰¾ä¸åˆ° é‚£ä¹ˆä½ å¯èƒ½è¿åäº†ä»¥ä¸‹çš„å‡ ä¸ªåŸåˆ™
   - å½“å‰ç”¨æˆ·å¹¶éç¨‹åºæ–‡ä»¶çš„æ‰€æœ‰è€…
   - å½“å‰ç”¨æˆ·å¹¶éç¨‹åºæ–‡ä»¶çš„ç»„æ‰€æœ‰è€…
   - ç”¨æˆ·æ²¡æœ‰å†™å½“å‰å·¥ä½œç›®å½•çš„è®¸å¯è¯
   - coreæ–‡ä»¶å¤ªå¤§(åœ¨1ä¸­å·²ç»æ’é™¤)
ä¹Ÿæœ‰å¯èƒ½ç”Ÿæˆäº†core ä½†æ˜¯ä½ ä¸çŸ¥é“æ”¾åœ¨äº†å“ªé‡Œ åœ¨linuxä¸­å†³å®šcoreæ–‡ä»¶è·¯å¾„çš„é…ç½®æ–‡ä»¶æ˜¯`/proc/sys/kernel/core_parten`æ–‡ä»¶ é»˜è®¤è¯¥æ–‡ä»¶ä¸ºç©º è¡¨æ˜coreé»˜è®¤ç”Ÿæˆåœ¨å¯æ‰§è¡Œç¨‹åºæ‰€åœ¨çš„è·¯å¾„ å¯ä»¥å°†å…¶è®¾ç½®ç”Ÿæˆåœ¨æŒ‡å®šçš„ç›®å½•é‡Œ ä½†æ˜¯è€ƒè™‘åˆ°ä¸åŒç¨‹åºç”Ÿæˆçš„coreæ–‡ä»¶æ˜¯åŒåçš„ å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„å†™æ³•
```
cat core_%e_%t >> /proc/sys/kernel/core_parten
```
å…¶ä¸­`%e`è¡¨ç¤ºçš„æ˜¯æ–‡ä»¶å,å³å¯æ‰§è¡Œç¨‹åºçš„åç§° `%t`æ ‡æ˜çš„æ˜¯ç”Ÿæˆæ—¶é—´ è¿™æ ·ç³»ç»Ÿç”Ÿæˆcoreæ–‡ä»¶æ—¶å°±æ˜¯ä»¥ç¨‹åºå + æ—¶é—´æˆ³æ¥å‘½åçš„
3. è·å–åˆ°coreæ–‡ä»¶ä¹‹å å¯ä»¥ä½¿ç”¨gdbå¯¹coreæ–‡ä»¶ä¿¡æ¯è¿›è¡ŒæŸ¥çœ‹ ä¸»è¦è¿˜æ˜¯çœ‹å‘ç”Ÿcoreæ—¶çš„å †æ ˆä¿¡æ¯ å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤
``` 
    gdb <exec_filename> <core_name>
```
è¿›å…¥åˆ°gdbå‘½ä»¤è¡Œä¸­ æ¥å¤ç°å½“æ—¶å‡ºé”™æ—¶çš„åœºæ™¯ ä¾‹å¦‚`print` `bt`ç­‰æ¥æŸ¥çœ‹


### dmesg+addr2line
æœ‰çš„æ—¶å€™å¯èƒ½ä¸éœ€è¦ä½¿ç”¨coreæ–‡ä»¶æ¥æ’æŸ¥é”™è¯¯ å¯ä»¥ä½¿ç”¨dmesgæ¥æŸ¥çœ‹ç¨‹åºå´©æºƒæ—¶ç¨‹åºæ‰€å¤„çš„ä½ç½®
ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå®šä½ç›¸å…³ç¨‹åºçš„é”™è¯¯è¾“å‡º
```
    dmesg | grep <exec_filename>
```
ä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯
```s
    298830.841498] traps: mix_hash_unitte[59596] general protection fault ip:555ccca2a384 sp:7ffebb38a0d0 error:0 in mix_hash_unittest[555ccca26000+54000]
    [298848.884994] traps: mix_hash_unitte[59655] general protection fault ip:560b83570384 sp:7ffe48d2ed10 error:0 in mix_hash_unittest[560b8356c000+54000]
    [298895.384162] traps: mix_hash_unitte[60014] general protection fault ip:55c3885cc384 sp:7fff788d9be0 error:0 in mix_hash_unittest[55c3885c8000+54000]
    [376673.620793] mix_hash_unitte[72596]: segfault at 10 ip 0000563aaf1308a5 sp 00007ffe039eb0b0 error 4 in mix_hash_unittest[563aaf12c000+54000]
    [376694.761516] mix_hash_unitte[72764]: segfault at 10 ip 0000564d2842989f sp 00007ffe70bb5b30 error 4 in mix_hash_unittest[564d28425000+54000]
    [376718.777092] mix_hash_unitte[72890]: segfault at 10 ip 0000555f6543789f sp 00007ffc1ba18950 error 4 in mix_hash_unittest[555f65433000+54000]
    [379184.907667] mix_hash_unitte[73931]: segfault at 10 ip 0000562d87def8c5 sp 00007ffc807d74d0 error 4 in mix_hash_unittest[562d87deb000+54000]
    [379454.090449] mix_hash_unitte[75092]: segfault at 10 ip 0000561b262078c5 sp 00007ffee112e230 error 4 in mix_hash_unittest[561b26203000+54000]
    [380733.083301] mix_hash_unitte[77429]: segfault at 0 ip 0000562c07615283 sp 00007ffcf9dd6d40 error 4 in mix_hash_unittest[562c07611000+54000]
```
ç„¶åæ¥ç€ä½¿ç”¨addr2lineæ¥å®šä½å¯¹åº”çš„ä»£ç è¡Œæ•°
```
    addr2line -e <exec_filename> -f -C <addr>
```
`-e`ç”¨æ¥æŒ‡å®šæ–‡ä»¶ `-f`æ˜¾ç¤ºå‡½æ•°å `-C`å¯ç”¨å¯ä¸ç”¨ ä¸»è¦æ˜¯å°†ç¼–è¯‘å™¨çš„å‡½æ•°ç¬¦å·è½¬æ¢æˆä»£ç é‡Œçš„å‡½æ•°ç¬¦å·

ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å¯ä»¥çœ‹åˆ°ä»£ç çš„å´©æºƒå‡½æ•°å’Œè¡Œå·çš„ åªè¦ä¸åœ¨libraryé‡Œå°±ğŸ‰‘ï¸....